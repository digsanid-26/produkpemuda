<% locals.page = 'projects' %>

<div class="top-bar">
    <h1 class="page-title"><%= action === 'create' ? 'Tambah Project Baru' : 'Edit Project' %></h1>
    <a href="/admin/projects" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Kembali
    </a>
</div>

<form method="POST" action="/admin/projects/<%= action === 'create' ? 'create' : 'edit/' + project.id %>" enctype="multipart/form-data">
    <div class="row">
        <div class="col-md-8">
            <!-- Main Content -->
            <div class="card mb-4">
                <div class="card-header">Informasi Utama</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Judul Project <span class="text-danger">*</span></label>
                        <input type="text" name="title" class="form-control" value="<%= project ? project.title : '' %>" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Deskripsi Singkat <span class="text-danger">*</span></label>
                        <textarea name="shortDescription" class="form-control" rows="2" required maxlength="200"><%= project ? project.shortDescription : '' %></textarea>
                        <small class="text-muted">Maksimal 200 karakter. Akan ditampilkan di halaman utama.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Konten Lengkap</label>
                        <textarea name="content" class="form-control" rows="8"><%= project ? project.content : '' %></textarea>
                        <small class="text-muted">Mendukung HTML untuk formatting.</small>
                    </div>
                </div>
            </div>

            <!-- SEO Settings -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-search"></i> Pengaturan SEO
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Meta Title</label>
                        <input type="text" name="seo_metaTitle" class="form-control" value="<%= project && project.seo ? project.seo.metaTitle : '' %>" maxlength="70">
                        <small class="text-muted">Maksimal 70 karakter. Kosongkan untuk menggunakan judul project.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Meta Description</label>
                        <textarea name="seo_metaDescription" class="form-control" rows="2" maxlength="160"><%= project && project.seo ? project.seo.metaDescription : '' %></textarea>
                        <small class="text-muted">Maksimal 160 karakter. Kosongkan untuk menggunakan deskripsi singkat.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Meta Keywords</label>
                        <input type="text" name="seo_metaKeywords" class="form-control" value="<%= project && project.seo ? project.seo.metaKeywords : '' %>">
                        <small class="text-muted">Pisahkan dengan koma. Contoh: project, portfolio, karya</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Canonical URL</label>
                        <input type="url" name="seo_canonical" class="form-control" value="<%= project && project.seo ? project.seo.canonical : '' %>" placeholder="https://example.com/project/slug">
                        <small class="text-muted">Kosongkan untuk menggunakan URL default.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">OG Image URL</label>
                        <input type="text" name="seo_ogImage" class="form-control" value="<%= project && project.seo ? project.seo.ogImage : '' %>" placeholder="/img/og-image.jpg">
                        <small class="text-muted">Gambar untuk dibagikan di media sosial. Kosongkan untuk menggunakan featured image.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Schema Markup (JSON-LD)</label>
                        <textarea name="seo_schema" class="form-control" rows="4" style="font-family: monospace; font-size: 12px;"><%= project && project.seo ? project.seo.schema : '' %></textarea>
                        <small class="text-muted">Masukkan JSON-LD schema markup untuk structured data.</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Publish Settings -->
            <div class="card mb-4">
                <div class="card-header">Publikasi</div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input type="checkbox" name="published" class="form-check-input" id="published" <%= project && project.published ? 'checked' : '' %>>
                            <label class="form-check-label" for="published">Publish project ini</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Urutan Tampil</label>
                        <input type="number" name="order" class="form-control" value="<%= project ? project.order : 1 %>" min="1">
                        <small class="text-muted">Urutan lebih kecil tampil lebih dulu.</small>
                    </div>
                    <hr>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-check-circle"></i> <%= action === 'create' ? 'Simpan Project' : 'Update Project' %>
                    </button>
                </div>
            </div>

            <!-- Featured Image Upload -->
            <div class="card mb-4">
                <div class="card-header">Featured Image</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Upload Gambar</label>
                        <input type="file" name="featuredImageFile" class="form-control" id="imageUpload" accept="image/*">
                        <small class="text-muted">Format: JPG, PNG, GIF, WebP. Max 5MB.</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Atau URL Gambar</label>
                        <input type="text" name="featuredImage" class="form-control" id="featuredImageInput" value="<%= project ? project.featuredImage : '/img/all-images/project/project-img14.png' %>">
                    </div>
                    <div class="mt-2">
                        <label class="form-label">Preview:</label>
                        <img src="<%= project ? project.featuredImage : '/img/all-images/project/project-img14.png' %>" alt="Preview" id="imagePreview" style="max-width: 100%; border-radius: 8px;">
                    </div>
                </div>
            </div>

            <!-- Category & Tags -->
            <div class="card mb-4">
                <div class="card-header">Kategori & Tag</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Kategori</label>
                        <select name="categoryId" class="form-select" required>
                            <option value="">Pilih Kategori</option>
                            <% categories.forEach(cat => { %>
                            <option value="<%= cat.id %>" <%= project && project.categoryId === cat.id ? 'selected' : '' %>><%= cat.name %></option>
                            <% }) %>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Tags</label>
                        <div class="tags-checkbox">
                            <% tags.forEach(tag => { %>
                            <div class="form-check">
                                <input type="checkbox" name="tags" value="<%= tag.id %>" class="form-check-input" id="tag_<%= tag.id %>" 
                                    <%= project && project.tags && project.tags.includes(tag.id) ? 'checked' : '' %>>
                                <label class="form-check-label" for="tag_<%= tag.id %>"><%= tag.name %></label>
                            </div>
                            <% }) %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
document.getElementById('featuredImageInput').addEventListener('change', function() {
    document.getElementById('imagePreview').src = this.value;
});

document.getElementById('imageUpload').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('imagePreview').src = e.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    }
});
</script>
